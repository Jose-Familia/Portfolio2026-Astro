---
/**
 * ShareButtons.astro
 * Botones para compartir en redes sociales
 */

import Icon from '@/components/ui/Icon.astro';

export interface Props {
  title: string;
  url: string;
}

const { title, url } = Astro.props;

// Construir URL absoluta usando el site configurado en astro.config.mjs
const siteUrl = import.meta.env.SITE || Astro.site?.href || '';
const pathname = new URL(url).pathname;
const absoluteUrl = siteUrl ? `${siteUrl.replace(/\/$/, '')}${pathname}` : url;

const encodedTitle = encodeURIComponent(title);
const encodedUrl = encodeURIComponent(absoluteUrl);

const shareLinks = [
  {
    name: 'LinkedIn',
    icon: 'linkedin',
    url: `https://www.linkedin.com/shareArticle?mini=true&url=${encodedUrl}&title=${encodedTitle}`,
  },
];
---

<div class="p-4 rounded-xl bg-neutral-50 dark:bg-neutral-900 border border-neutral-200 dark:border-neutral-800">
  <h2 class="text-sm font-semibold text-neutral-900 dark:text-neutral-50 mb-3">
    Compartir
  </h2>
  <div class="flex gap-2">
    {shareLinks.map((link) => (
      <a
        href={link.url}
        target="_blank"
        rel="noopener noreferrer"
        class="p-2.5 rounded-lg bg-neutral-100 dark:bg-neutral-800 text-neutral-600 dark:text-neutral-400 hover:text-primary-600 dark:hover:text-primary-400 hover:bg-neutral-200 dark:hover:bg-neutral-700 transition-colors"
        aria-label={`Compartir en ${link.name}`}
        title={link.name}
      >
        <Icon name={link.icon} size={18} />
      </a>
    ))}
    <button
      type="button"
      class="p-2.5 rounded-lg bg-neutral-100 dark:bg-neutral-800 text-neutral-600 dark:text-neutral-400 hover:text-primary-600 dark:hover:text-primary-400 hover:bg-neutral-200 dark:hover:bg-neutral-700 transition-colors"
      aria-label="Copiar enlace"
      title="Copiar enlace"
      data-copy-url={absoluteUrl}
      id="copy-link-btn"
    >
      <Icon name="copy" size={18} />
    </button>
  </div>
</div>

<script>
  const copyBtn = document.getElementById('copy-link-btn');
  
  copyBtn?.addEventListener('click', async () => {
    const url = copyBtn.getAttribute('data-copy-url');
    if (url) {
      try {
        await navigator.clipboard.writeText(url);
        // Feedback visual
        copyBtn.innerHTML = `<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" class="text-green-500"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/></svg>`;
        setTimeout(() => {
          copyBtn.innerHTML = `<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"/></svg>`;
        }, 2000);
      } catch (err) {
        console.error('Error al copiar:', err);
      }
    }
  });
</script>
